import { useEffect, useRef } from "react"

export default function Preview({ html }) {
  const iframeRef = useRef(null)

  useEffect(() => {
    if (!html) return

    const script = `
      <script>
        document.addEventListener("mouseover", function(e) {
          const element = e.target;
          element.style.outline = "2px solid red";

          window.parent.postMessage({
            type: "ELEMENT_HOVER",
            tag: element.tagName,
            id: element.id,
            className: element.className
          }, "*");
        });

        document.addEventListener("mouseout", function(e) {
          e.target.style.outline = "";
        });
      <\/script>
    `

    const updatedHtml = html.replace("</body>", script + "</body>")

    iframeRef.current.srcdoc = updatedHtml

  }, [html])

  return (
    <iframe
      ref={iframeRef}
      style={{
        width: "100%",
        height: "90%",
        border: "1px solid #ccc",
        marginTop: "10px"
      }}
      title="preview"
    />
  )
}
